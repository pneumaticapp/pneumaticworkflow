{% extends "base.html" %}

{% block title %}{{ subject|default:"Pneumatic Digest" }}{% endblock %}

{% block content %}
<div style="margin-top:0;outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:'Times New Roman','Arial',serif;vertical-align:baseline;background-color:#f6f6f6;height:100%;line-height:inherit;padding:0 16px;border:0">
  <!-- Title Section -->
  <table align="center" style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;border-collapse:separate;border-spacing:0;max-width:640px;width:100%;table-layout:fixed;line-height:inherit;margin:0 auto 32px;padding:0;border:0">
    <tbody>
      <tr style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;border-collapse:collapse;line-height:inherit;margin:0;padding:0;border:0">
      </tr>
      <tr style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;border-collapse:collapse;line-height:inherit;margin:0;padding:0;border:0">
        <td align="center" style="outline:0;font-weight:normal;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;text-align:left;border-collapse:collapse;line-height:inherit;margin:0;padding:0;border:0" valign="baseline">
          <p style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;display:block;line-height:inherit;margin:0;padding:0;border:0">
          <span style="outline:0;font-weight:800;font-style:inherit;font-size:28px;font-family:inherit;vertical-align:baseline;line-height:32px;text-align:center;letter-spacing:-0.01em;color:#262522;display:block;margin:0;padding:0;border:0">
                                {% if is_tasks_digest %}Tasks Weekly Digest{% else %}Workflows Weekly Digest{% endif %}
                            </span>
            {% if date_from and date_to %}
            <span style="outline:0;font-weight:800;font-style:inherit;font-size:20px;font-family:inherit;vertical-align:baseline;line-height:24px;text-align:center;color:#979795;display:block;margin:0;padding:0;border:0">
              {{ date_from }} to {{ date_to }}
            </span>
            {% endif %}
          </p>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Summary Stats -->
  <table align="center" style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;border-collapse:separate;border-spacing:0;width:100%;table-layout:fixed;max-width:640px;line-height:inherit;margin:0 auto;padding:0;border:0">
    <tbody>
      <tr style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;border-collapse:collapse;line-height:inherit;margin:0;padding:0;border:0">
        <td style="outline:0;font-weight:normal;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;text-align:left;border-collapse:collapse;line-height:inherit;margin:0;padding:0;border:0" align="left" valign="baseline">
          <div style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;background-color:white;border-radius:23px;line-height:inherit;margin:0 0 16px;padding:32px;border:0">
            <!-- Started -->
            <div style="margin-bottom:16px;line-height:24px">
              <div style="display:inline-block;width:74%;line-height:inherit">
                <a href="{{ base_link }}{{ status_queries.started }}" style="text-decoration:none;line-height:inherit">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;vertical-align:baseline;color:#2196f3;line-height:inherit;margin:0;padding:0;border:0">
                    {{ status_labels.started }}
                  </span>
                </a>
              </div>
              <div style="display:inline-block;width:25%;text-align:right;line-height:inherit" align="right">
                <a href="{{ base_link }}{{ status_queries.started }}" style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;text-decoration:none;line-height:inherit;margin:0;padding:0;border:0">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;font-family:inherit;vertical-align:baseline;text-align:center;letter-spacing:-0.01em;color:#2196f3;display:inline-block;line-height:inherit;margin:0;padding:0;border:0">
                    {{ started|default:0 }}
                  </span>
                </a>
              </div>
            </div>
            <!-- In Progress -->
            <div style="margin-bottom:16px;line-height:24px">
              <div style="display:inline-block;width:74%;line-height:inherit">
                <a href="{{ base_link }}{{ status_queries.in_progress }}" style="text-decoration:none;line-height:inherit">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;vertical-align:baseline;color:#ffc107;line-height:inherit;margin:0;padding:0;border:0">
                    {{ status_labels.in_progress }}
                  </span>
                </a>
              </div>
              <div style="display:inline-block;width:25%;text-align:right;line-height:inherit" align="right">
                <a href="{{ base_link }}{{ status_queries.in_progress }}" style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;text-decoration:none;line-height:inherit;margin:0;padding:0;border:0">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;font-family:inherit;vertical-align:baseline;text-align:center;letter-spacing:-0.01em;color:#ffc107;display:inline-block;line-height:inherit;margin:0;padding:0;border:0">
                    {{ in_progress|default:0 }}
                  </span>
                </a>
              </div>
            </div>
            <!-- Overdue -->
            <div style="margin-bottom:16px;line-height:24px">
              <div style="display:inline-block;width:74%;line-height:inherit">
                <a href="{{ base_link }}{{ status_queries.overdue }}" style="text-decoration:none;line-height:inherit">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;vertical-align:baseline;color:#f44336;line-height:inherit;margin:0;padding:0;border:0">
                    {{ status_labels.overdue }}
                  </span>
                </a>
              </div>
              <div style="display:inline-block;width:25%;text-align:right;line-height:inherit" align="right">
                <a href="{{ base_link }}{{ status_queries.overdue }}" style="outline:0;font-weight:bold;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;text-decoration:none;line-height:inherit;margin:0;padding:0;border:0">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;font-family:inherit;vertical-align:baseline;text-align:center;letter-spacing:-0.01em;color:#f44336;display:inline-block;line-height:inherit;margin:0;padding:0;border:0">
                    {{ overdue|default:0 }}
                  </span>
                </a>
              </div>
            </div>
            <!-- Completed -->
            <div style="margin-bottom:0px;line-height:24px">
              <div style="display:inline-block;width:74%">
                <a href="{{ base_link }}{{ status_queries.completed }}" style="text-decoration:none;line-height:inherit">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;vertical-align:baseline;color:#4caf50;line-height:inherit;margin:0;padding:0;border:0">
                    {{ status_labels.completed }}
                  </span>
                </a>
              </div>
              <div style="display:inline-block;width:25%;text-align:right;line-height:inherit" align="right">
                <a href="{{ base_link }}{{ status_queries.completed }}" style="outline:0;font-weight:bold;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;text-decoration:none;line-height:inherit;margin:0;padding:0;border:0">
                  <span style="outline:0;font-weight:bold;font-style:inherit;font-size:20px;vertical-align:baseline;text-align:center;letter-spacing:-0.01em;color:#4caf50;display:inline-block;line-height:inherit;margin:0;padding:0;border:0">
                    {{ completed|default:0 }}
                  </span>
                </a>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Templates List -->
  {% if templates %}
  <div style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;line-height:inherit;margin:0;padding:0;border:0">
    {% for template in templates %}
    <table style="outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline;border-collapse:separate;width:100%;max-width:640px;background-color:white;border-radius:23px;table-layout:fixed;line-height:inherit;margin:8px auto 0;padding:24px 20px 24px 32px;border:0;box-sizing:border-box;" bgcolor="white">
      <tbody>
        <tr style="vertical-align:top;border-collapse:collapse;line-height:inherit">
          <td style="text-align:left;vertical-align:top;border-collapse:collapse;line-height:inherit" align="left" valign="top">
            <!-- Template Name -->
            <div style="width:64%;display:inline-block;vertical-align:middle;line-height:inherit">
              <table width="100%" cellpadding="0" cellspacing="0" style="border-spacing:0;vertical-align:top;border-collapse:collapse;line-height:inherit">
                <tbody>
                  <tr style="vertical-align:top;border-collapse:collapse;line-height:inherit">
                    <td align="left" style="text-align:left;font-family:inherit;font-weight:800;font-size:20px;line-height:24px;vertical-align:top;border-collapse:collapse" valign="top">
                      <a href="{{ base_link }}?{{ template_query_param }}={{ template.template_id }}" style="text-decoration:none;line-height:inherit">
                        <span style="outline:0;font-weight:800;font-style:inherit;font-size:20px;font-family:'Times New Roman',serif;line-height:24px;color:#262522;display:block;margin:0;padding:0;border:0">
                          {{ template.template_name }}
                        </span>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Template Stats -->
            <div style="width:35%;display:inline-block;vertical-align:middle;line-height:inherit">
              <table width="100%" cellpadding="0" cellspacing="0" style="border-spacing:0;vertical-align:top;border-collapse:collapse;line-height:inherit">
                <tbody>
                  <tr style="vertical-align:top;border-collapse:collapse;line-height:inherit">
                    <td style="text-align:right;vertical-align:top;border-collapse:collapse;line-height:inherit" align="right" valign="top">
                      <table style="border-collapse:collapse;border-spacing:0;margin-left:auto;vertical-align:middle;line-height:inherit;">
                        <tbody>
                          <tr style="vertical-align:top;border-collapse:collapse;line-height:inherit">
                            <td style="vertical-align:top;border-collapse:collapse;line-height:inherit" valign="top">
                              <div style="display:table-cell;text-align:center;vertical-align:middle;width:40px;height:40px;font-weight:800;font-size:20px;border-radius:8px;background-color:#e9f5fe;color:#2196f3;border-left:4px solid white;border-right:4px solid white;font-family:inherit;" align="center">
                                {{ template.started|default:0 }}
                              </div>
                            </td>
                            <td style="vertical-align:top;border-collapse:collapse;line-height:inherit" valign="top">
                              <div style="display:table-cell;text-align:center;vertical-align:middle;width:40px;height:40px;font-weight:800;font-size:20px;border-radius:8px;background-color:#fff9e7;color:#ffc107;border-left:4px solid white;border-right:4px solid white;font-family:inherit;" align="center">
                                {{ template.in_progress|default:0 }}
                              </div>
                            </td>
                            <td style="vertical-align:top;border-collapse:collapse;line-height:inherit" valign="top">
                              <div style="display:table-cell;text-align:center;vertical-align:middle;width:40px;height:40px;font-weight:800;font-size:20px;border-radius:8px;background-color:#feedeb;color:#f44336;border-left:4px solid white;border-right:4px solid white;font-family:inherit;" align="center">
                                {{ template.overdue|default:0 }}
                              </div>
                            </td>
                            <td style="vertical-align:top;border-collapse:collapse;line-height:inherit" valign="top">
                              <div style="display:table-cell;text-align:center;vertical-align:middle;width:40px;height:40px;font-weight:800;font-size:20px;border-radius:8px;background-color:#eef7ee;color:#4caf50;border-left:4px solid white;border-right:4px solid white;font-family:inherit;" align="center">
                                {{ template.completed|default:0 }}
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <!-- Tasks for Tasks Digest -->
            {% if is_tasks_digest and template.tasks %}
            {% for task in template.tasks %}
            <div style="margin-top: 16px; border-top: 1px solid #f0f0f0; padding-top: 16px;">
              <div style="width:64%;display:inline-block;vertical-align:middle;">
                <a href="{{ base_link }}?{{ template_query_param }}={{ template.template_id }}&template-step={{ task.task_id }}" style="text-decoration: none;">
                  <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: 800;font-style: inherit;font-size: 15px;font-family:'Arial', sans-serif;line-height: 20px;color: #262522;display: block;">
                    {{ task.task_name }}
                  </span>
                </a>
              </div>
              <div style="width:35%;display:inline-block;vertical-align:middle;text-align:right;">
                <span style="display:inline-table;text-align:center;width:40px;height:32px;font-size:15px;border-radius:8px;background-color:white;color:#2196F3;border-left:4px solid white;border-right:4px solid white;font-family:'Arial',sans-serif;font-weight:bold;margin-right:4px;vertical-align:middle;">
                  <span style="display:table-cell;vertical-align:middle;">{{ task.started|default:0 }}</span>
                </span>
                <span style="display:inline-table;text-align:center;width:40px;height:32px;font-size:15px;border-radius:8px;background-color:white;color:#FFC107;border-left:4px solid white;border-right:4px solid white;font-family:'Arial',sans-serif;font-weight:bold;margin-right:4px;vertical-align:middle;">
                  <span style="display:table-cell;vertical-align:middle;">{{ task.in_progress|default:0 }}</span>
                </span>
                <span style="display:inline-table;text-align:center;width:40px;height:32px;font-size:15px;border-radius:8px;background-color:white;color:#F44336;border-left:4px solid white;border-right:4px solid white;font-family:'Arial',sans-serif;font-weight:bold;margin-right:4px;vertical-align:middle;">
                  <span style="display:table-cell;vertical-align:middle;">{{ task.overdue|default:0 }}</span>
                </span>
                <span style="display:inline-table;text-align:center;width:40px;height:32px;font-size:15px;border-radius:8px;background-color:white;color:#4CAF50;border-left:4px solid white;border-right:4px solid white;font-family:'Arial',sans-serif;font-weight:bold;vertical-align:middle;">
                  <span style="display:table-cell;vertical-align:middle;">{{ task.completed|default:0 }}</span>
                </span>
              </div>
            </div>
            {% endfor %}
            {% endif %}
          </td>
        </tr>
      </tbody>
    </table>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Custom Content (if provided) -->
  {% if content %}
  <table width="100%" border="0" cellpadding="24" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word">
    <tr>
      <td>
        <div style="font-family:Arial,sans-serif">
          <div style="font-size:16px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#262522;line-height:1.8">
            <div class="dynamic-content">
              {{ content|safe }}
            </div>
          </div>
        </div>
      </td>
    </tr>
  </table>
  {% endif %}

  <!-- Button -->
  {% if workflows_link or tasks_link or notifications_link %}
  <table width="100%" border="0" cellpadding="24" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0">
    <tr>
      <td>
        <div align="center">
          {% if workflows_link %}
          <a href="{{ workflows_link }}" target="_blank" style="text-decoration:none;display:inline-block;color:#262522;background-color:#fec336;border-radius:24px;padding:8px 32px;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;font-size:16px;text-align:center;margin:8px;">
            <span style="line-height:32px;">
              <strong>View Workflows</strong>
            </span>
          </a>
          {% endif %}
          {% if tasks_link %}
          <a href="{{ tasks_link }}" target="_blank" style="text-decoration:none;display:inline-block;color:#262522;background-color:#fec336;border-radius:24px;padding:8px 32px;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;font-size:16px;text-align:center;margin:8px;">
            <span style="line-height:32px;">
              <strong>View Tasks</strong>
            </span>
          </a>
          {% endif %}
          {% if notifications_link %}
          <a href="{{ notifications_link }}" target="_blank" style="text-decoration:none;display:inline-block;color:#262522;background-color:#fec336;border-radius:24px;padding:8px 32px;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;font-size:16px;text-align:center;margin:8px;">
            <span style="line-height:32px;">
              <strong>View Notifications</strong>
            </span>
          </a>
          {% endif %}
        </div>
      </td>
    </tr>
  </table>
  {% endif %}
</div>
{% endblock %}