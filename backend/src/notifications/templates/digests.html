{% extends "base.html" %}

{% block title %}{{ subject|default:"Pneumatic Digest" }}{% endblock %}

{% block content %}
<table class="row row-2"
       align="center"
       width="100%"
       border="0"
       cellpadding="0"
       cellspacing="0"
       role="presentation"
       style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f6f6f6">
  <tbody>
    <tr>
      <td>
        <table class="row-content stack"
               align="center"
               border="0"
               cellpadding="0"
               cellspacing="0"
               role="presentation"
               style="mso-table-lspace:0;mso-table-rspace:0;color:#333;width:640px"
               width="640">
          <tbody>
            <tr>
              <td class="column column-1"
                  width="100%"
                  style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;background-color:#fff;vertical-align:top;">
                <!-- Title -->
                <table class="heading_block block-1"
                       width="100%"
                       border="0"
                       cellpadding="0"
                       cellspacing="0"
                       role="presentation"
                       style="mso-table-lspace:0;mso-table-rspace:0">
                  <tr>
                    <td class="pad"
                        style="padding-bottom:32px;padding-left:48px;padding-right:48px;padding-top:48px;text-align:center;width:100%">
                      <h1 style="margin:0;color:#262522;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:28px;font-weight:400;line-height:120%;text-align:center;">
                        <strong>{{ title|default:"Digest" }}</strong>
                      </h1>
                    </td>
                  </tr>
                </table>

                <!-- Date Range -->
                {% if date_from and date_to %}
                <table class="text_block block-2"
                       width="100%"
                       border="0"
                       cellpadding="0"
                       cellspacing="0"
                       role="presentation"
                       style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word">
                  <tr>
                    <td class="pad"
                        style="padding-bottom:24px;padding-left:48px;padding-right:48px">
                      <div style="font-family:Arial,sans-serif">
                        <div style="font-size:16px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#262522;line-height:1.2;text-align:center;">
                          <p style="margin:0;">
                            {{ date_from }} - {{ date_to }}
                          </p>
                        </div>
                      </div>
                    </td>
                  </tr>
                </table>
                {% endif %}

                <!-- Summary Stats -->
                <table class="text_block block-3"
                       width="100%"
                       border="0"
                       cellpadding="24"
                       cellspacing="0"
                       role="presentation"
                       style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word">
                  <tr>
                    <td class="pad">
                      <div style="font-family:Arial,sans-serif">
                        <div style="margin: 0; margin-bottom:16px; padding: 32px;border: 0;outline: 0;font-weight: inherit;font-style: inherit;font-size: 100%;font-family: inherit;vertical-align: baseline;background: white;border-radius: 23px; position: relative;">
                          <div style="margin-bottom: 16px; line-height: 24px;">
                            <div style="display:inline-block;width:74%;">
                              <a href="{{ base_link }}{{ status_queries.started }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;vertical-align: baseline;color: #2196F3;">
                                  {{ status_labels.started }}
                                </span>
                              </a>
                            </div>
                            <div style="display:inline-block;width:25%;text-align:right;">
                              <a href="{{ base_link }}{{ status_queries.started }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;font-family: inherit;vertical-align: baseline;text-align: center;letter-spacing: -0.01em;color: #2196F3;display: inline-block;">
                                  {{ started|default:0 }}
                                </span>
                              </a>
                            </div>
                          </div>
                          <div style="margin-bottom: 16px;line-height:24px">
                            <div style="display:inline-block;width:74%;">
                              <a href="{{ base_link }}{{ status_queries.in_progress }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;vertical-align: baseline;color: #FFC107;">
                                  {{ status_labels.in_progress }}
                                </span>
                              </a>
                            </div>
                            <div style="display:inline-block;width:25%;text-align:right;">
                              <a href="{{ base_link }}{{ status_queries.in_progress }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;font-family: inherit;vertical-align: baseline;text-align: center;letter-spacing: -0.01em;color: #FFC107;display: inline-block;">
                                  {{ in_progress|default:0 }}
                                </span>
                              </a>
                            </div>
                          </div>
                          <div style="margin-bottom: 16px;line-height:24px;">
                            <div style="display:inline-block;width:74%;">
                              <a href="{{ base_link }}{{ status_queries.overdue }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;vertical-align: baseline;color: #F44336;">
                                  {{ status_labels.overdue }}
                                </span>
                              </a>
                            </div>
                            <div style="display:inline-block;width:25%;text-align:right;">
                              <a href="{{ base_link }}{{ status_queries.overdue }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;font-family: inherit;vertical-align: baseline;text-align: center;letter-spacing: -0.01em;color: #F44336;display: inline-block;">
                                  {{ overdue|default:0 }}
                                </span>
                              </a>
                            </div>
                          </div>
                          <div style="margin-bottom: 0px;line-height: 24px;">
                            <div style="display: inline-block;width:74%">
                              <a href="{{ base_link }}{{ status_queries.completed }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;vertical-align: baseline;color: #4CAF50;">
                                  {{ status_labels.completed }}
                                </span>
                              </a>
                            </div>
                            <div style="display:inline-block;width:25%;text-align:right;">
                              <a href="{{ base_link }}{{ status_queries.completed }}" style="text-decoration: none;">
                                <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: bold;font-style: inherit;font-size: 20px;vertical-align: baseline;text-align: center;letter-spacing: -0.01em;color: #4CAF50;display: inline-block;">
                                  {{ completed|default:0 }}
                                </span>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </table>

                <!-- Templates List -->
                {% if templates %}
                {% for template in templates %}
                <table class="text_block"
                       width="100%"
                       border="0"
                       cellpadding="0"
                       cellspacing="0"
                       role="presentation"
                       style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word;margin: 0 auto;padding: 24px 20px 24px 32px;width: 100%;max-width: 640px;margin-top: 8px;background: white;border-radius: 23px;">
                  <tr>
                    <td class="pad" style="padding: 24px;">
                      <div style="font-family:Arial,sans-serif">
                        <div style="width:64%;display:inline-block;vertical-align:middle;">
                          <a href="{{ base_link }}?{{ template_query_param }}={{ template.template_id }}" style="text-decoration: none;">
                            <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: 800;font-style: inherit;font-size: 20px;font-family:'Times New Roman', serif;line-height: 24px;color: #262522;display: block;">
                              {{ template.template_name }}
                            </span>
                          </a>
                        </div>
                        <div style="width:35%;display:inline-block;vertical-align:middle;text-align:right;">
                          <div style="text-align:center;width:40px;height:24px;padding-top:8px;padding-bottom:8px;font-weight: 800;font-size: 20px;line-height: 24px;border-radius: 8px;background-color:#E9F5FE;color:#2196F3;border-left:4px solid white;border-right:4px solid white;font-family:inherit;display:inline-block;margin-right:4px;">
                            {{ template.started|default:0 }}
                          </div>
                          <div style="text-align:center;width:40px;height:24px;padding-top:8px;padding-bottom:8px;font-weight: 800;font-size: 20px;line-height: 24px;border-radius: 8px;background-color:#FFF9E7;color:#FFC107;border-left:4px solid white;border-right:4px solid white;font-family:inherit;display:inline-block;margin-right:4px;">
                            {{ template.in_progress|default:0 }}
                          </div>
                          <div style="text-align:center;width:40px;height:24px;padding-top:8px;padding-bottom:8px;font-weight: 800;font-size: 20px;line-height: 24px;border-radius: 8px;background-color:#FEEDEB;color:#F44336;border-left:4px solid white;border-right:4px solid white;font-family:inherit;display:inline-block;margin-right:4px;">
                            {{ template.overdue|default:0 }}
                          </div>
                          <div style="text-align:center;width:40px;height:24px;padding-top:8px;padding-bottom:8px;font-weight: 800;font-size: 20px;line-height: 24px;border-radius: 8px;background-color:#EEF7EE;color:#4CAF50;border-left:4px solid white;border-right:4px solid white;font-family:inherit;display:inline-block;">
                            {{ template.completed|default:0 }}
                          </div>
                        </div>
                        
                        <!-- Tasks for Tasks Digest -->
                        {% if is_tasks_digest and template.tasks %}
                        {% for task in template.tasks %}
                        <div style="margin-top: 16px; border-top: 1px solid #f0f0f0; padding-top: 16px;">
                          <div style="width:64%;display:inline-block;vertical-align:middle;">
                            <a href="{{ base_link }}?{{ template_query_param }}={{ template.template_id }}&template-step={{ task.task_id }}" style="text-decoration: none;">
                              <span style="margin: 0;padding: 0;border: 0;outline: 0;font-weight: 800;font-style: inherit;font-size: 15px;font-family:'Arial', sans-serif;line-height: 20px;color: #262522;display: block;">
                                {{ task.task_name }}
                              </span>
                            </a>
                          </div>
                          <div style="width:35%;display:inline-block;vertical-align:middle;text-align:right;">
                            <div style="text-align:center;width:40px;height:24px;font-size: 15px;line-height: 20px;border-radius: 8px;background-color:white;color:#2196F3;border-left:4px solid white;border-right:4px solid white;font-family:'Arial', sans-serif;font-weight: bold;display:inline-block;margin-right:4px;">
                              {{ task.started|default:0 }}
                            </div>
                            <div style="text-align:center;width:40px;height:24px;font-size: 15px;line-height: 20px;border-radius: 8px;background-color:white;color:#FFC107;border-left:4px solid white;border-right:4px solid white;font-family:'Arial', sans-serif;font-weight: bold;display:inline-block;margin-right:4px;">
                              {{ task.in_progress|default:0 }}
                            </div>
                            <div style="text-align:center;width:40px;height:24px;font-size: 15px;line-height: 20px;border-radius: 8px;background-color:white;color:#F44336;border-left:4px solid white;border-right:4px solid white;font-family:'Arial', sans-serif;font-weight: bold;display:inline-block;margin-right:4px;">
                              {{ task.overdue|default:0 }}
                            </div>
                            <div style="text-align:center;width:40px;height:24px;font-size: 15px;line-height: 20px;border-radius: 8px;background-color:white;color:#4CAF50;border-left:4px solid white;border-right:4px solid white;font-family:'Arial', sans-serif;font-weight: bold;display:inline-block;">
                              {{ task.completed|default:0 }}
                            </div>
                          </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                </table>
                {% endfor %}
                {% endif %}

                <!-- Custom Content (if provided) -->
                {% if content %}
                <table class="text_block"
                       width="100%"
                       border="0"
                       cellpadding="24"
                       cellspacing="0"
                       role="presentation"
                       style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word">
                  <tr>
                    <td class="pad">
                      <div style="font-family:Arial,sans-serif">
                        <div style="font-size:16px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#262522;line-height:1.8">
                          <div class="dynamic-content">
                            {{ content|safe }}
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </table>
                {% endif %}

                <!-- Button -->
                {% if workflows_link or tasks_link or notifications_link %}
                <table class="button_block"
                       width="100%"
                       border="0"
                       cellpadding="24"
                       cellspacing="0"
                       role="presentation"
                       style="mso-table-lspace:0;mso-table-rspace:0">
                  <tr>
                    <td class="pad">
                      <div class="alignment" align="center">
                        {% if workflows_link %}
                        <a href="{{ workflows_link }}"
                           target="_blank"
                           style="text-decoration:none;display:inline-block;color:#262522;background-color:#fec336;border-radius:24px;padding:8px 32px;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;font-size:16px;text-align:center;margin:8px;">
                          <span style="line-height:32px;">
                            <strong>View Workflows</strong>
                          </span>
                        </a>
                        {% endif %}
                        {% if tasks_link %}
                        <a href="{{ tasks_link }}"
                           target="_blank"
                           style="text-decoration:none;display:inline-block;color:#262522;background-color:#fec336;border-radius:24px;padding:8px 32px;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;font-size:16px;text-align:center;margin:8px;">
                          <span style="line-height:32px;">
                            <strong>View Tasks</strong>
                          </span>
                        </a>
                        {% endif %}
                        {% if notifications_link %}
                        <a href="{{ notifications_link }}"
                           target="_blank"
                           style="text-decoration:none;display:inline-block;color:#262522;background-color:#fec336;border-radius:24px;padding:8px 32px;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;font-size:16px;text-align:center;margin:8px;">
                          <span style="line-height:32px;">
                            <strong>View Notifications</strong>
                          </span>
                        </a>
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                </table>
                {% endif %}
              </td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
  </tbody>
</table>
{% endblock %}
